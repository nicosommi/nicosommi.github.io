<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-tsx.53d7234727541c2cbd94.css">@font-face{font-family:Open Sans Extra Bold;src:url(/fonts/open-sans/OpenSans-ExtraBold.ttf)}@font-face{font-family:Cooper Hewitt;src:url(/fonts/cooper-hewitt/CooperHewitt-Light.otf)}@font-face{font-family:PT Sans;src:url(/fonts/pt-sans/PTN57F.ttf)}code{background-color:azure;font-family:Menlo,Monaco,Courier New,monospace}html,p{line-height:1.8em}body{font-family:PT Sans,Georgia,serif;font-size:14pt;margin:2%}h1{font-family:Open Sans Extra Bold,Lucida Grande,Lucida Sans,Lucida Sans Regular,Lucida Sans Unicode,Geneva,Verdana,sans-serif;letter-spacing:-1pt;line-height:1.2em}h2,h3,h4,h5,h6{font-family:Cooper Hewitt;letter-spacing:1.3pt;text-transform:uppercase}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-templates-post-tsx.53d7234727541c2cbd94.css.map*/</style><script>window.__EMOTION_CRITICAL_CSS_IDS__ = ["0","wq1mo7","dr0eep","1phry7t","1bnxa12","1vohbo4","bue21p"];</script><style>@-webkit-keyframes animation-wq1mo7{from 0%{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(calc(360deg*3));-ms-transform:rotate(calc(360deg*3));transform:rotate(calc(360deg*3));}}@keyframes animation-wq1mo7{from 0%{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(calc(360deg*3));-ms-transform:rotate(calc(360deg*3));transform:rotate(calc(360deg*3));}}.css-dr0eep{-webkit-text-decoration:none;text-decoration:none;color:black;}.css-dr0eep:hover{color:purple;outline:1px solid gray;outline-offset:2px;}.css-dr0eep:focus{outline:1px dashed gray;outline-offset:2px;}.css-1phry7t{color:gray;margin:0;}.css-1bnxa12{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;}.css-1vohbo4{margin:5% 20%;}.css-bue21p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;font-size:0.75em;line-height:2em;}</style><title data-react-helmet="true">nicosommi</title><meta data-react-helmet="true" name="description" content="nicosommi blog"/><meta data-react-helmet="true" name="keywords" content="blog, developer, javascript, typescript"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-44929876-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-44929876-1', 'auto');
      ga('set', 'anonymizeIp', true);}
      </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-acea8035f6ab39fa26d1.js"/><link as="script" rel="preload" href="/app-874540d8bcf4d5d5bf5b.js"/><link as="script" rel="preload" href="/11-06ad2655c3750dad69af.js"/><link as="script" rel="preload" href="/0-3f1dc8449dcbff735e4e.js"/><link as="script" rel="preload" href="/webpack-runtime-dc1a68a101aacc508386.js"/><link rel="preload" href="/static/d/363/path---2014-04-20-debugging-node-seriously-959-5bc-R08VRKU1g2RLgc9yPX6IQxKbeMs.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="margin-bottom:1.45rem"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1 style="margin:0"><a class="css-dr0eep" href="/">nicosommi</a></h1><h6 class="css-1phry7t"><span>developer</span></h6><div class="css-1bnxa12"><h3 class="css-0"><a class="css-dr0eep" href="/posts">posts</a></h3><h3 class="css-0"><a class="css-dr0eep" href="/slides">slides</a></h3><h3 class="css-0"><a class="css-dr0eep" href="/about">about</a></h3></div></div></div><div class="css-1vohbo4"><h1>Debugueando node</h1><div>April 20, 2014</div><div>4<!-- --> min read</div><div><p><a class="css-dr0eep" href="/?p=284"><em>To see this article in english click here.</em></a></p>
<p>Cuando programamos en Node.js siempre hay cositas que vuelan por la cabeza. Hay muchas cosas en las que pensar. Muchas cosas que tener en cuenta. Es simple, pero hay que saber lo que se est√° haciendo al alt√≠simo precio de llegar a un l√≠o muy importante. Javascript. Npm. Lo bueno, lo malo y lo feo.</p>
<p>Una de las cosas que m√°s me asustaban en este node-hell es poder depurar nuestro script. Muchos solemos usar muy frecuentemente logging de distintos tipos, desde el simple console.log hasta paquetes m√°s copados como debug, ain2, winston o algo as√≠. Pero muchos evaden el viejo y conocido debug, que nos permite agregar watch expressions, evaluar ejecuciones en el contexto actual, observar el backtrace, y otras cositas mas.</p>
<p>En mi experiencia hab√≠a debuggeado previamente node en mis comienzos, pero de una forma muy distinta. Usando eclipse. Vengo de Java as√≠ que me resultaba familiar, y el debugger V8 se conecta sin problemas a un proceso node ejecutando en modo debug (con ‚Äìdebug). Sin lugar a dudas es una muy buena alternativa. Sin embargo hoy tengo un entorno de desarrollo mucho m√°s din√°mico y liviano en memoria. Tambi√©n puedo abrir el chrome y hacer lo mismo que del eclipse pero desde ah√≠. Pero hay dos motivos en contra de eso: los que no usamos Chrome (yo uso Firefox por ahora) y los que encima no desarrollamos necesariamente algo web con node.js y no necesitamos abrir el browser. Gedit y Sublime son los editores que uso frecuentemente. Perder el miedo a la consola es algo que aprendemos todos los que somos habitu√© de ubuntu, git, y esas cosas. Perder el miedo a la consola es tambi√©n clave para no complicarse la vida con la depuraci√≥n en node.js.</p>
<p>Es tan sencillo como lo siguiente: es un debugger como los que conocemos de toda la vida pero comandado por consola. Desde algunos lenguajes ya vienen acostumbrados a esto, sin embargo yo que vengo de Java, y anteriormente C# y TIBCO, estoy acostumbrado a debuggers de todo tipo pero es la primera vez que experimento con la consola.</p>
<p>Primero que nada repasemos la necesidad. Esto surge de la experiencia en ambientes reales en donde solucionar un problema complejo en ambientes productivos es algo habitual. Los logging de consola algunas veces son precarios en algunos aspectos y nos limitan a la hora de solucionar un problema r√°pidamente. Muchos podr√°n discutir sobre este tema apoyados en su rapidez y lucidez mental constante. Yo prefiero saber que no dependo de eso. Prefiero no sentir esa presi√≥n. Prefiero saber como debuggear y detectar el problema mirando mejor el contexto. Dem√°s est√° decir que algunas veces los errores son tan complicados que la reproducci√≥n del mismo nos lleva mucho tiempo y sincronizaci√≥n, y por ende estar√≠a buen√≠simo si descubrimos el error en la menor cantidad de intentos posibles.</p>
<p>Mencionados ya los beneficios de usar un debugger, vayamos al acto. El uso trivial es sencillo: ponemos un debugger; en donde nos plazca y luego ejecutamos la aplicaci√≥n con el argumento debug.</p>
<p><code>node debug script.js</code></p>
<p>Algo tan simple como eso ya nos deja en la consola de debug. Ahora es sencillo, para lo que antes haciamos en entornos gr√°ficos ahora tenemos un string que dispara el comando. Por ejemplo poniendo ‚Äòcont‚Äô o ‚Äòc‚Äô el debugger avanzar√° hasta el pr√≥ximo debugger;</p>
<p>Hay una lista completa de comandos en la secci√≥n Commands reference en el siguiente link <a href="http://nodejs.org/api/debugger.html" target="" class="css-dr0eep">http://nodejs.org/api/debugger.html</a></p>
<p>Los m√°s destacados son</p>
<ul>
<li>step in: se hace escribiendo s</li>
<li>step out: escribiendo o</li>
<li>next step: n</li>
<li>pause</li>
<li>watch(‚ÄòvariableName‚Äô) : imprimira el valor en cada paso</li>
<li>unwatch(‚ÄòvariableName‚Äô) : dejara de monitorear el valor</li>
<li>list(4) : imprime el contexto en un radio de 4 lineas</li>
<li>repl : important√≠simo, nos permite evaluar algo en el contexto actual como el console del browser (tenemos todo lo del contexto pero no podemos modificarlo). Salimos con ctrl+c</li>
</ul>
<p>Hay ‚Äúcomplicaciones‚Äù extra para quienes utilizan gulp/grunt (casi todos) ejecutando algunas tareas previas a iniciar la aplicaci√≥n‚Ä¶ pero buenas noticias, se puede utilizar algo como por ejemplo nodemon en esos casos, con la opci√≥n nodeArgs.</p>
<p>Por ejemplo:</p>
<p><code>nodemon({script: &#x27;./app.js&#x27;, nodeArgs: [&#x27;debug&#x27;]})</code></p>
<p>Otro caso com√∫n. Test unit. Con debug? S√≠. Por ejemplo si ejecutamos</p>
<p><code>mocha debug test/ejemplo.js</code></p>
<p>entonces nos llevar√° a la consola de debug.</p>
<p>Combinando mocha y grunt/gulp se puede hacer esto (tambi√©n con nodemon):</p>
<p><code>nodemon({script: &#x27;./node_modules/mocha/bin/_mocha&#x27;, nodeArgs: [&#x27;debug&#x27;]});</code></p>
<p>donde pon√©s la ruta a tu instalaci√≥n global del ejecutable _mocha (con gui√≥n bajo) y listo, con eso ten√©s tus test con el debugger built in y tus tareas previas ejecutadas.</p>
<p>Obteniendo un error ENOSPC?</p>
<p>Eso es porque hay muchos archivos abiertos (o ten√©s un editor que suele abrir muchos archivos como Sublime o nodemon est√° incluyendo muchos archivos).</p>
<p>Lo pod√©s solucionar incrementando el valor de max<em>user</em>watches con este comando</p>
<p><code>sudo sysctl fs.inotify.max_user_watches=20000</code></p>
<p>El n√∫mero correcto depende de tus necesidades. Pod√©s ver que ten√©s actualmente ejecutando esto</p>
<p><code>more /proc/sys/fs/inotify/max_user_watches</code></p>
<p>Tambi√©n record√° executar nodemon con el argumento -i nodemodules</p>
<p>En definitiva. Si todav√≠a no lo hiciste animate que es sencillo. Hace un script sencillo que cuente hasta 100 en un for y probalo vos mismo.</p>
<p>Ten√©s una idea para mejorar este art√≠culo? Mand√°mela a nicosommi@gmail.com</p></div><div>nico</div></div><div class="css-bue21p"><span>Copyright nicosommi. <span aria-label="nerd face" role="img" class="css-0">ü§ì</span></span></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-tsx","jsonName":"2014-04-20-debugging-node-seriously-959","path":"/2014/04/20/debugging-node-seriously/"};window.dataPath="363/path---2014-04-20-debugging-node-seriously-959-5bc-R08VRKU1g2RLgc9yPX6IQxKbeMs";/*]]>*/</script><script src="/webpack-runtime-dc1a68a101aacc508386.js" async=""></script><script src="/0-3f1dc8449dcbff735e4e.js" async=""></script><script src="/11-06ad2655c3750dad69af.js" async=""></script><script src="/app-874540d8bcf4d5d5bf5b.js" async=""></script><script src="/component---src-templates-post-tsx-acea8035f6ab39fa26d1.js" async=""></script></body></html>